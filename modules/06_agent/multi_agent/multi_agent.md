# 多智能体系统 (Multi-Agent Systems)

> [!TIP]
> **一句话通俗理解**：多智能体通过角色分工与协作协议并行处理子任务，提升复杂任务的鲁棒性与执行效率。

多智能体系统通过多个 Agent 协作完成复杂任务，是 AI Agent 发展的重要方向。

---

## 协作模式

### 1. 去中心化协作 (Decentralized)

- Agent 之间通过标准协议通信
- 每个 Agent 拥有独立 Persona 与职责
- 典型框架：AutoGen、MetaGPT
- 无中央调度，依赖协商和共识

### 2. 层级协作 (Hierarchical)

- 主 Agent 负责规划和协调
- 子 Agent 负责执行具体任务
- 典型的 Master-Worker 模式

### 3. 群体智能 (Swarm Intelligence)

- 大量轻量化 Agent 的涌现行为
- 解决分布式复杂问题
- 动态角色分配

---

## 核心机制

### 1. 通信协议

- 定义 Agent 间交换信息的 Schema
- 确保协作过程中的数据一致性
- 支持同步和异步消息

### 2. 角色分担

- 明确每个 Agent 的职责边界
- 避免职责重叠导致的冲突
- 支持动态角色切换

### 3. 人类介入 (Human-in-the-Loop)

- 关键动作前的确认机制
- 提供调试与纠偏入口
- 平衡自动化与安全性

---

## 编排架构

### 1. 状态机编排

- 将 Agent 的不同执行阶段定义为"状态"
- 通过明确的转移条件驱动
- 适用于高可靠性要求的工程流

### 2. 异步编排

- 利用 Message Bus 解耦请求与响应
- Agent 后台异步执行
- 完成后通过总线反馈

### 3. 条件路由

- 根据 LLM 输出动态路由到不同子任务
- 支持不同能力的模型

---
## 定义与目标

- **定义**：多智能体系统 (Multi-Agent Systems) 属于“Agent 模块，讨论规划、记忆、工具调用与多智能体协作机制。”范畴。
- **目标**：把单轮问答能力扩展为可执行、多步骤、可恢复的任务流。
## 适用场景与边界

- **适用场景**：用于任务拆解、工具编排、长期记忆与流程自动化场景。
- **不适用场景**：不适用于无需工具调用和状态管理的简单问答任务。
- **使用边界**：系统效果受工具可靠性、提示策略与反馈闭环影响。

## 关键步骤

1. 把用户目标拆解为可执行子任务与状态节点。
2. 循环执行“规划-调用工具-观察反馈-修正计划”。
3. 在达到终止条件后输出结果并记录可审计轨迹。
## 关键公式（逻辑表达）

`AgentLoop = Plan -> Act -> Observe -> Reflect`

符号说明：
- `Plan`：任务拆解与行动规划。
- `Act`：工具调用与执行。
- `Reflect`：基于反馈修正策略。
## 关键步骤代码（纯文档示例）

```python
# 关键流程示意（与具体工程实现解耦）
state = init_state()
for step in range(num_steps):
    state = step_update(state)
metrics = evaluate(state)
```

## 工程实现要点

- 先定义状态机与失败恢复路径，再扩展工具数量。
- 为关键动作设置审计日志与人工确认机制。
- 区分短期上下文与长期记忆，避免上下文膨胀。

## 常见错误与排查

- **症状**：Agent 循环执行或无法收敛。  
  **原因**：停止条件不明确或反馈信号噪声过大。  
  **解决**：引入明确终止条件与步数上限。
- **症状**：调用工具频繁失败。  
  **原因**：工具接口契约不一致或参数验证不足。  
  **解决**：统一 Tool schema 并增加输入校验与重试策略。

## 与相近方法对比

| 方法 | 优点 | 局限 | 适用场景 |
| --- | --- | --- | --- |
| 本文主题方法 | 紧贴本节问题定义 | 依赖数据与实现质量 | 适合结构化评测与迭代优化 |
| 对比方法A | 上手成本更低 | 能力上限可能受限 | 快速原型与基线对照 |
| 对比方法B | 上限潜力更高 | 调参与资源成本更高 | 高要求生产或复杂任务场景 |

## 参考资料

- [ReAct](https://arxiv.org/abs/2210.03629)
- [Toolformer](https://arxiv.org/abs/2302.04761)

